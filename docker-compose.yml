version: "3.9"

services:
  # ==========================
  # Banco MySQL
  # ==========================
  mysql:
    image: ubuntu:24.04
    platform: linux/arm64
    container_name: mysql
    networks:
      - dev-network
    volumes:
      - mysql-data:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
    command: >
      bash -c "
      apt update &&
      apt install -y mysql-server &&
      service mysql start &&
      tail -f /dev/null
      "
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 5s
      retries: 10
      timeout: 5s
      start_period: 10s

  # ==========================
  # Containers de Linguagem
  # ==========================

  # dev-python:
  #   build:
  #     context: ./python
  #     dockerfile: Dockerfile
  #     platform: linux/arm64
  #   volumes:
  #     - ./workspace:/workspace
  #     - python-packages:/root/.local/lib/python3.11/site-packages
  #   environment:
  #     DB_HOST: mysql
  #     DB_USER: ${MYSQL_USER}
  #     DB_PASSWORD: ${MYSQL_PASSWORD}
  #     DB_NAME: ${MYSQL_DATABASE}
  #   depends_on:
  #     mysql:
  #       condition: service_healthy
  #   networks:
  #     - dev-network
  #   command: sleep infinity
  #   ports:
  #     - "3000:3000"

  # dev-java:
  #   build:
  #     context: ./java
  #     dockerfile: Dockerfile
  #     platform: linux/arm64
  #   volumes:
  #     - ./workspace:/workspace
  #     - java-libs:/usr/local/lib/java
  #   environment:
  #     DB_HOST: mysql
  #     DB_USER: ${MYSQL_USER}
  #     DB_PASSWORD: ${MYSQL_PASSWORD}
  #     DB_NAME: ${MYSQL_DATABASE}
  #   depends_on:
  #     mysql:
  #       condition: service_healthy
  #   networks:
  #     - dev-network
  #   command: sleep infinity

  # dev-node:
  #   build:
  #     context: ./node
  #     dockerfile: Dockerfile
  #     platform: linux/arm64
  #   volumes:
  #     - ./workspace:/workspace
  #     - node-modules:/workspace/node_modules
  #   environment:
  #     DB_HOST: mysql
  #     DB_USER: ${MYSQL_USER}
  #     DB_PASSWORD: ${MYSQL_PASSWORD}
  #     DB_NAME: ${MYSQL_DATABASE}
  #   depends_on:
  #     mysql:
  #       condition: service_healthy
  #   networks:
  #     - dev-network
  #   command: sleep infinity
  #   ports:
  #     - "8000:8000"

  # dev-cpp:
  #   build:
  #     context: ./cpp
  #     dockerfile: Dockerfile
  #     platform: linux/arm64
  #   volumes:
  #     - ./workspace:/workspace
  #     - cpp-libs:/usr/local/lib/arduino
  #   environment:
  #     DB_HOST: mysql
  #     DB_USER: ${MYSQL_USER}
  #     DB_PASSWORD: ${MYSQL_PASSWORD}
  #     DB_NAME: ${MYSQL_DATABASE}
  #   depends_on:
  #     mysql:
  #       condition: service_healthy
  #   networks:
  #     - dev-network
  #   command: sleep infinity

# ==========================
# Volumes persistentes
# ==========================
volumes:
  # python-packages:
  # java-libs:
  # node-modules:
  # cpp-libs:
  mysql-data:

# ==========================
# Rede compartilhada
# ==========================
networks:
  dev-network:
